# /config/pkg/integral.yaml

template:
#
  - sensor:
#  
    - name: Sun Elevation
      state: "{{ state_attr('sun.sun', 'elevation') }}"
      state_class: measurement
      unit_of_measurement: 'Â°'

    - name: Fake Export W
      state: >-
        {% set a = states('sensor.sun_elevation')|float %}
        {% if a > 0 %}
          {{ (a * 20)|round(1) }}
        {% else %}
          {{ 1 }}
        {% endif %}
      device_class: power
      state_class: measurement
      unit_of_measurement: "W"

### ### ###

sensor:

  - platform: integration
    source: sensor.eb3_active_power_l1
    name: EM3 L1
    unit_prefix: k
    round: 2

  - platform: integration
    source: sensor.eb3_active_power_l2
    name: EM3 L2
    unit_prefix: k
    round: 2

  - platform: integration
    source: sensor.eb3_active_power_l3
    name: EM3 L3
    unit_prefix: k
    round: 2

  - platform: integration
    source: sensor.u1_power
    name: EM UPS1
    unit_prefix: k
    round: 2

  - platform: integration
    source: sensor.athom_p1_energy_power
    name: EM Athom P1
    unit_prefix: k
    round: 2

  - platform: integration
    source: sensor.fake_export_w
    name: Fake Export kWh
    unit_prefix: k
    round: 2

# EOF
